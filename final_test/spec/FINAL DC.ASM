/* FINAL DIGITAL CLOCK */

ORG 00H
	MOV R6,#53
	MOV R7,#53
	MOV R5,#57
	MOV R4,#53
	MOV R3,#51
	MOV R2,#50
	
	MOV A,#01H		;CLEAR DISPLAY
	ACALL CMD
	ACALL INIT		; INITIAL CONDITIONS
	J:
	   MOV A,#' '
        ACALL DAT
        MOV A,#'T'
        ACALL DAT
        MOV A,#'I'
        ACALL DAT
        MOV A,#'M'
        ACALL DAT
        MOV A,#'E'
        ACALL DAT
        MOV A,#':'
        ACALL DAT
		MOV A,R2
		ACALL DAT
		MOV A,R3
		ACALL DAT
		MOV A,#':'
		ACALL DAT
		MOV A,R4
		ACALL DAT
		MOV A,R5
		ACALL DAT
		MOV A,#':'
		ACALL DAT
		MOV A,R7
		ACALL DAT
		MOV A,R6
		ACALL DAT
		ACALL DELAY1SEC
		JMP TIME
	
CMD:					;COMMAND EXECUTION
	MOV P1,A			
	CLR P2.0			;RS=0 --> CMD
	CLR P2.1			;R/W=0  -->WRITE
	SETB P2.2			;E=1  -->ENABLE 
	ACALL DELAY
	CLR P2.2			;E=0  -->DISABLE
	RET
	
DAT:					;DATA
	MOV P1,A
	SETB P2.0			;RS=1 --> DATA
	CLR P2.1			;R/W=0  -->WRITE DATA
	SETB P2.2			;E=1  -->ENABLE
	ACALL DELAY
	CLR P2.2			;E=0  -->DISABLE
	RET
	
INIT:
	MOV A,#38H			;8-bit, 2 Line, 5x7 Dots
	ACALL CMD
	MOV A,#0CH			;Display on Cursor on
	ACALL CMD
	ACALL DELAY	
	RET
	
TIME:
MOV A,#01H
LCALL CMD

	MOV A,R6
	INC A
	CJNE A,#58,X01
	MOV R6,#48
	MOV A,R7
	INC A
	CJNE A,#54,X02
	MOV R7,#48
	MOV A,R5
	INC A
	CJNE A,#58,X11
	MOV R5,#48
	MOV A,R4
	INC A
	CJNE A,#54,X12
	MOV R4,#48
	MOV A,R3
	INC A
	CJNE A,#52,X21
	MOV R3,#48
	MOV A,R2
	INC A
	CJNE A,#51,X22
	MOV R2,#48	
	JMP J

X01:
	INC R6
	JMP J
X02:
	INC R7
	JMP J
X11:
	INC R5
	JMP J
X12:
	INC R4
	JMP J
X21:
	INC R3
	JMP J
X22:
	INC R2
	JMP J


DELAY:
	 
	HERE1:MOV R1,#255
	HERE3:DJNZ R1,HERE3
	HERE2S:MOV R1,#255
	HERE4:DJNZ R1,HERE4
		
		RET
	
DELAY1SEC:
	MOV TMOD,#11H
	L:
		MOV TH1,#0FFH
		MOV TL1,#0ECH
	D1S:MOV TH0,#03CH
		MOV TL0,#0C1H
		SETB TR0
		AGAIN:JNB TF0,AGAIN
		CLR TR0
		CLR TF0
		SETB TR1
		CLR TR1
		JNB TF1,D1S
		CLR TF1
RET
NOP
E:
END